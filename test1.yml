apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: test1
spec:
  parameters:
    clientID: {{kvClientId}}
    keyvaultName: {{kvName}}
    objects: |
      array:
        - |
          objectName: cert1
          objectType: secret
    tenantId: {{kvTenantId}}
    usePodIdentity: "false"
    useVMManagedIdentity: "false"
  provider: azure
---
apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    azure.workload.identity/client-id: {{kvClientId}}
  name: test1
---
apiVersion: v1
kind: Pod
metadata:
  name: test1
  labels:
    azure.workload.identity/use: 'true'
spec:
  serviceAccountName: test1
  containers:
  - name: test1
    image: '{{acrName}}.azurecr.io/tests/test1:latest'
    volumeMounts:
    - name: certs
      mountPath: /certs
      readOnly: true
  volumes:
    - name: certs
      csi:
        driver: secrets-store.csi.k8s.io
        readOnly: true
        volumeAttributes:
          secretProviderClass: test1
---
